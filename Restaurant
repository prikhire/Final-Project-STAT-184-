restaurant <- function() {
  library(ggplot2)
  library(dplyr)
  library(reshape2)
  library(stringr)
  library(data.table)
  library(geosphere)
  library(lubridate)
  library(rvest)
  library(tidyverse)
  library(rebus)
  
  setwd(./data/)
  payment_type <- fread("chefmozaccepts.csv")
  cuisine <- fread("chefmozcuisine.csv")
  hours <- fread("chefmozhours4.csv")
  parking <- fread("chefmozparking.csv")
  geninfo <- fread("geoplaces2.csv")
  ratings <- fread("rating_final.csv")
  usercuisine <- fread("usercuisine.csv")
  userpayment<- fread("userpayment.csv")
  userprofile <- fread("userprofile.csv")
  setkey(usercuisine, userID)
  setkey(userpayment, userID)
  setkey(userprofile, userID)
  userinfo <- merge(userprofile,usercuisine, all.x = T)
  userinfo <- merge(userinfo, userpayment, all.x = T)
  setkey(cuisine, placeID)
  setkey(hours, placeID)
  setkey(geninfo, placeID)
  setkey(parking, placeID)
  setkey(payment_type, placeID)
  placeinfo <- merge(geninfo, cuisine, all.x = T)
  placeinfo <- merge(placeinfo, hours, all.x = T)
  placeinfo <- merge(placeinfo, parking, all.x = T)
  placeinfo <- merge(placeinfo, payment_type, all.x = T)
  sub_hoursOpen <- placeinfo[,c("placeID", "hours" , "days")]
  sub_hoursOpen$days <- gsub("Mon;Tue;Wed;Thu;Fri;", "weekdays", sub_hoursOpen$days)
  sub_hoursOpen<- sub_hoursOpen[!duplicated(sub_hoursOpen[,.(placeID, days)]),]
  placeHours <- dcast.data.table(sub_hoursOpen, placeID ~ days, value.var = "hours")
  placeinfo <- select(placeinfo, -hours, -days)
  setnames(placeHours, "Sat;", "Saturday")
  setnames(placeHours, "Sun;", "Sunday")
  setnames(placeHours, "weekdays", "Weekdays")
  setkey(placeinfo, placeID)
  setkey(placeHours, placeID)
  placeinfo <- merge(placeinfo, placeHours, all.x = T)
  placeinfo$V1 <- NULL
  
  sub_Placeplot <- placeinfo[,c("placeID", "alcohol", "smoking_area", "dress_code", "accessibility", "price", "Rambience", "area", "parking_lot", "Rpayment", "Rcuisine")]
  prating <- ratings[,c("placeID", "rating")]
  prating <- prating[!duplicated(prating[,.(placeID)]),]
  setkey(sub_Placeplot, placeID)
  setkey(prating, placeID)
  sub_Placeplot <- merge(sub_Placeplot, prating, all.x = T)
  placeinfo <- placeinfo[!duplicated(placeinfo[,.(placeID, alcohol, smoking_area, dress_code, accessibility, price, Rambience, area, Rcuisine, parking_lot, Rpayment)]),]
  sub_Placeplot <- na.omit(sub_Placeplot)
  sub_Placeplot$alcohol <- gsub("No_Alcohol_Served", 0 , sub_Placeplot$alcohol)
  sub_Placeplot$alcohol <- gsub("Wine-Beer", 1 , sub_Placeplot$alcohol)
  sub_Placeplot$alcohol <- gsub("Full_Bar", 2 , sub_Placeplot$alcohol)
  sub_Placeplot$smoking_area <- gsub("not permitted", 0 , sub_Placeplot$smoking_area)
  sub_Placeplot$smoking_area <- gsub("none", 1 , sub_Placeplot$smoking_area)
  sub_Placeplot$smoking_area <- gsub("only at bar", 2 , sub_Placeplot$smoking_area)
  sub_Placeplot$smoking_area <- gsub("section", 3 , sub_Placeplot$smoking_area)
  sub_Placeplot$smoking_area <- gsub("permitted", 4 , sub_Placeplot$smoking_area)
  sub_Placeplot$dress_code <- gsub("informal", 0 , sub_Placeplot$dress_code)
  sub_Placeplot$dress_code <- gsub("casual", 1 , sub_Placeplot$dress_code)
  sub_Placeplot$dress_code <- gsub("formal", 2 , sub_Placeplot$dress_code)
  sub_Placeplot$accessibility <- gsub("no_accessibility", 0 , sub_Placeplot$accessibility)
  sub_Placeplot$accessibility <- gsub("partially", 1 , sub_Placeplot$accessibility)
  sub_Placeplot$accessibility <- gsub("completely", 2 , sub_Placeplot$accessibility)
  sub_Placeplot$price <- gsub("low", 0 , sub_Placeplot$price)
  sub_Placeplot$price <- gsub("medium", 1 , sub_Placeplot$price)
  sub_Placeplot$price <- gsub("high", 2 , sub_Placeplot$price)
  sub_Placeplot$Rambience <- gsub("quiet", 0 , sub_Placeplot$Rambience)
  sub_Placeplot$Rambience <- gsub("familiar", 1 , sub_Placeplot$Rambience)
  sub_Placeplot$area <- gsub("closed", 0, sub_Placeplot$area)
  sub_Placeplot$area <- gsub("open", 1, sub_Placeplot$area)
  sub_Placeplot$parking_lot <- gsub("none", 0 , sub_Placeplot$parking_lot)
  sub_Placeplot$parking_lot <- gsub("public",1 , sub_Placeplot$parking_lot)
  sub_Placeplot$parking_lot <- gsub("valet parking",2 , sub_Placeplot$parking_lot)
  sub_Placeplot$parking_lot <- gsub("yes", 3 , sub_Placeplot$parking_lot)
  sub_Placeplot$Rpayment <- gsub("cash", 0 , sub_Placeplot$Rpayment)
  sub_Placeplot$Rpayment <- gsub("checks", 1 , sub_Placeplot$Rpayment)
  sub_Placeplot$Rpayment <- gsub("bank_debit_cards", 2 , sub_Placeplot$Rpayment)
  sub_Placeplot$Rpayment <- gsub("VISA", 3 , sub_Placeplot$Rpayment)
  sub_Placeplot$Rpayment <- gsub("MasterCard-Eurocard", 4 , sub_Placeplot$Rpayment)
  sub_Placeplot$Rpayment <- gsub("Discover", 5 , sub_Placeplot$Rpayment)
  sub_Placeplot$Rpayment <- gsub("Carte_Blanche", 6 , sub_Placeplot$Rpayment)
  sub_Placeplot$Rpayment <- gsub("American_Express", 7 , sub_Placeplot$Rpayment)
  sub_Placeplot$alcohol <- as.numeric(sub_Placeplot$alcohol)
  sub_Placeplot$smoking_area <- as.numeric(sub_Placeplot$smoking_area)
  sub_Placeplot$dress_code <- as.numeric(sub_Placeplot$dress_code)
  sub_Placeplot$accessibility <- as.numeric(sub_Placeplot$accessibility)
  sub_Placeplot$price <- as.numeric(sub_Placeplot$price)
  sub_Placeplot$Rambience <- as.numeric(sub_Placeplot$Rambience)
  sub_Placeplot$area <- as.numeric(sub_Placeplot$area)
  sub_Placeplot$parking_lot <- as.numeric(sub_Placeplot$parking_lot)
  sub_Placeplot$Rpayment <- as.numeric(sub_Placeplot$Rpayment)
  sub_Placeplot$rating <- as.numeric(sub_Placeplot$rating)
  analysis <- prcomp(sub_Placeplot[,2:10,12])
  place_analysis <- data.frame(analysis$x)
  place_analysis$Cuisine <- sub_Placeplot$Rcuisine
  ggplot(place_analysis,aes(x=PC1,y=PC2,col=Cuisine))+geom_point()
  ggsave("place_analysis.pdf", width = 5, height = 5)
  
  userpayment <- userinfo[,c("Rcuisine", "Upayment")]
  setnames(userpayment, "Rcuisine", "Ucuisine")
  userpayment <- na.omit(userpayment)
  userpayment <- sample_n(userpayment, 100)
  ggplot(userpayment, aes(Upayment, Ucuisine)) + geom_count()
  ggsave("userpayments.pdf", width = 5, height = 5)
  placePayment <- placeinfo[,c("Rcuisine", "Rpayment")]
  placePayment <- na.omit(placePayment)
  placePayment<- sample_n(placePayment, 100)
  ggplot(placePayment, aes(Rpayment, Rcuisine)) + geom_count()
  ggsave("placePayments.pdf", width = 5, height = 5) 
  
  }
